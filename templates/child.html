{% extends "base.html" %}
{% load static %}
{% block UserName %} {{ UserName }} {% endblock %}
{% block Title %} CHILD {% endblock %}
{% block functionTitle %} REGISTRATION{% endblock %}

{% block content %}


    <form action="{% url 'core:save_child' %}" method="post">

        {% csrf_token %}
        {% comment %}
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Child Details</h4>
                            <div class="flex-shrink-0">
                                <div class="alert  alert-dismissible" role="alert">
                                    {% if messages %}
                                        {% for message in messages %}
                                            <!-- Danger Alert -->
                                            <div class="alert alert-{{ message.tags }} alert-dismissible border-2 bg-body-secondary fade show"
                                                 role="alert">
                                                <strong>
                                                    <center> {{ message }}</center>
                                                </strong>
                                                <button type="button" class="btn-close" data-bs-dismiss="alert"
                                                        aria-label="Close"></button>
                                            </div>
                                        {% endfor %}
                                    {% endif %}       <!-- end row -->
                                </div>
                            </div>
                        </div><!-- end card header -->
                        <div class="card-body">
                            <div class="live-preview">
                                <div class="row gy-4">
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            {{ form.admission_number }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            {{ form.admission_date }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            {{ form.recipt_number }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            <div class="form-check form-switch">
                                                {{ form.is_polymath_student }}
                                                <label class="form-check-label">Is Polymath student?</label>

                                            </div>
                                        </div>
                                    </div>


                                    <!--end col-->
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            {{ form.child_first_name }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            {{ form.child_last_name }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-xxl-3 col-md-6">
                                        <div>
                                            {{ form.date_of_birth }}
                                        </div>
                                    </div>
                                    <!--end col-->

                                    <!--end col-->


                                </div>
                                <!--end row-->
                            </div>
                        </div>

                    </div>

                    <div class="card">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Parent's Details</h4>
                            <div class="flex-shrink-0">

                            </div>
                        </div><!-- end card header -->
                        <div class="card-body">
                            <div class="live-preview">
                                <div class="row gy-4">

                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.fathers_name }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.fathers_contact_number }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.fathers_whatsapp_number }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.mothers_name }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-md-4">
                                        <div>
                                            {{ form.mothers_contact_number }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-md-4">
                                        <div>
                                            {{ form.mothers_whatsapp_number }}
                                        </div>
                                    </div>
                                    <!--end col-->

                                </div>
                                <!--end row-->
                            </div>
                        </div>

                    </div>

                    <div class="card">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Contact Details</h4>
                            <div class="flex-shrink-0">

                            </div>
                        </div><!-- end card header -->
                        <div class="card-body">
                            <div class="live-preview">
                                <div class="row gy-4">

                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.resident_contact_number }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.address_line1 }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.address_line2 }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class=" col-md-4">
                                        <div>
                                            {{ form.address_line3 }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <div class="col-md-4">
                                        <div>
                                            {{ form.email_address }}
                                        </div>
                                    </div>
                                    <!--end col-->
                                    <!-- Base Buttons -->
                                    <div class="col-12">
                                        <button class="btn btn-secondary" type="submit">Submit form</button>
                                    </div>

                                </div>
                                <!--end row-->

                            </div>
                        </div>
                        <div>

                        </div>

                    </div>

                </div>
            </div> {% endcomment %}
    </form>

    <!-- Data Table-->
    <div class="card">
        <div class="card-header border-0">
            <div class="d-flex align-items-center">
                <h5 class="card-title mb-0 flex-grow-1">Registered Children</h5>
                <div class="flex-shrink-0">
                    <div class="d-flex flex-wrap gap-2">
                        <button class="btn btn-secondary add-btn" data-bs-toggle="modal" data-bs-target="#showModal"><i
                                class="ri-add-line align-bottom me-1"></i> Add new child
                        </button>
                        <button class="btn btn-soft-secondary" id="remove-actions" onclick="deleteMultiple()"><i
                                class="ri-delete-bin-2-line"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body">
            <table id="ChildList" class="display" style="width:100%">
                <thead>
                <tr>
                    <th></th>
                    <th></th>
                    <th>Admission No</th>
                    <th>First name</th>
                    <th>Last name</th>
                    <th>Admission date</th>
                    <th>Father's contact number</th>
                    <th>Mother's contact number</th>
                    <th>Residence phone numbers</th>
                    <th>Polymath Student?</th>
                    <th>Status</th>

                </tr>
                </thead>
                <tbody>
                {% for child in childrenList %}
                    <tr>
                        <td>
                            <a href="#" class="link-danger" data-bs-target="#firstmodal" data-bs-toggle="modal"
                               data-bs-dismiss="modal" aria-label="close"><i class="ri-delete-bin-line"></i></a>
                        </td>
                        <td><a href="javascript:void(0);" class="link-success"><i class=" ri-edit-2-fill"></i></a>
                        </td>
                        <td>{{ child.admission_number }}</td>
                        <td>{{ child.child_first_name }}</td>
                        <td>{{ child.child_last_name }}</td>
                        <td>{{ child.admission_date|date:'Y-m-d' }}</td>
                        <td>{{ child.fathers_contact_number }}</td>
                        <td>{{ child.mothers_contact_number }}</td>
                        <td>{{ child.resident_contact_number }}</td>
                        {% if child.is_polymath_student %}
                            <td><span class="badge bg-secondary-subtle text-secondary">Yes</span></td>
                        {% else %}
                            <td><span class="badge bg-warning-subtle text-warning">No</span></td>
                        {% endif %}
                        {% if child.is_active %}
                            <td><span class="badge bg-success">Active</span></td>
                        {% else %}
                            <td><<span class="badge bg-danger">Inactive</span></td>
                        {% endif %}

                    </tr>
                {% endfor %}

                </tbody>
            </table>
        </div><!-- end card-body -->
    </div>



{% endblock %}
{% block modals %}
     <div class="modal fade zoomIn" id="showModal" tabindex="-1" aria-labelledby="exampleModalLabel"
         style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0">
                <div class="modal-header p-3 bg-secondary-subtle">
                    <h5 class="modal-title" id="exampleModalLabel">Add Child</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
                            id="close-modal"></button>
                </div>
                <form action="{% url 'core:save_child' %}" method="post" class="tablelist-form" autocomplete="on">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-header align-items-center d-flex">
                                        <h4 class="card-title mb-0 flex-grow-1">Child Details</h4>
                                        <div class="flex-shrink-0">
                                            <div class="alert  alert-dismissible" role="alert">
                                                {% if messages %}
                                                    {% for message in messages %}
                                                        <!-- Danger Alert -->
                                                        <div class="alert alert-{{ message.tags }} alert-dismissible border-2 bg-body-secondary fade show"
                                                             role="alert">
                                                            <strong>
                                                                <center> {{ message }}</center>
                                                            </strong>
                                                            <button type="button" class="btn-close"
                                                                    data-bs-dismiss="alert"
                                                                    aria-label="Close"></button>
                                                        </div>
                                                    {% endfor %}
                                                {% endif %}       <!-- end row -->
                                            </div>
                                        </div>
                                    </div><!-- end card header -->
                                    <div class="card-body">
                                        <div class="live-preview">
                                            <div class="row gy-4">
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        {{ form.admission_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        {{ form.admission_date }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        {{ form.recipt_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        <div class="form-check form-switch">
                                                            {{ form.is_polymath_student }}
                                                            <label class="form-check-label">Is Polymath
                                                                student?</label>

                                                        </div>
                                                    </div>
                                                </div>


                                                <!--end col-->
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        {{ form.child_first_name }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        {{ form.child_last_name }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-xxl-3 col-md-6">
                                                    <div>
                                                        {{ form.date_of_birth }}
                                                    </div>
                                                </div>
                                                <!--end col-->

                                                <!--end col-->


                                            </div>
                                            <!--end row-->
                                        </div>
                                    </div>

                                </div>

                                <div class="card">
                                    <div class="card-header align-items-center d-flex">
                                        <h4 class="card-title mb-0 flex-grow-1">Parent's Details</h4>
                                        <div class="flex-shrink-0">

                                        </div>
                                    </div><!-- end card header -->
                                    <div class="card-body">
                                        <div class="live-preview">
                                            <div class="row gy-4">

                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.fathers_name }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.fathers_contact_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.fathers_whatsapp_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.mothers_name }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-md-4">
                                                    <div>
                                                        {{ form.mothers_contact_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-md-4">
                                                    <div>
                                                        {{ form.mothers_whatsapp_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->

                                            </div>
                                            <!--end row-->
                                        </div>
                                    </div>

                                </div>

                                <div class="card">
                                    <div class="card-header align-items-center d-flex">
                                        <h4 class="card-title mb-0 flex-grow-1">Contact Details</h4>
                                        <div class="flex-shrink-0">

                                        </div>
                                    </div><!-- end card header -->
                                    <div class="card-body">
                                        <div class="live-preview">
                                            <div class="row gy-4">

                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.resident_contact_number }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.address_line1 }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.address_line2 }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class=" col-md-4">
                                                    <div>
                                                        {{ form.address_line3 }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                                <div class="col-md-4">
                                                    <div>
                                                        {{ form.email_address }}
                                                    </div>
                                                </div>
                                                <!--end col-->
                                            </div>
                                            <!--end row-->

                                        </div>
                                    </div>
                                    <div>

                                    </div>

                                </div>

                            </div>
                        </div>

                    </div>
                    <div class="modal-footer" style="display: block;">
                        <div class="hstack gap-2 justify-content-end">
                            <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                            <button class="btn btn-secondary" type="submit">Submit form</button>
                            <!-- <button type="button" class="btn btn-success" id="edit-btn">Update</button> -->
                        </div>
                    </div>
                </form>

            </div>
        </div>
    </div>

    <!-- First modal dialog -->
    <div class="modal fade" id="firstmodal" aria-hidden="true" aria-labelledby="..." tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-5">
                    <lord-icon
                            src="https://cdn.lordicon.com/tdrtiskw.json"
                            trigger="loop"
                            colors="primary:#f7b84b,secondary:#405189"
                            style="width:130px;height:130px">
                    </lord-icon>
                    <div class="mt-4 pt-4">
                        <h4>Uh oh, something went wrong!</h4>
                        <p class="text-muted"> The transfer was not successfully received by us. the email of the
                            recipient wasn't correct.</p>
                        <!-- Toogle to second dialog -->
                          <button class="btn btn-soft-danger" data-bs-target="#firstmodal" data-bs-toggle="modal" data-bs-dismiss="modal">No </button>
                        <button class="btn btn-danger" data-bs-target="#secondmodal" data-bs-toggle="modal"
                                data-bs-dismiss="modal">
                            Yes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Second modal dialog -->
<div class="modal fade" id="secondmodal" aria-hidden="true" aria-labelledby="..." tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <lord-icon
                    src="https://cdn.lordicon.com/zpxybbhl.json"
                    trigger="loop"
                    colors="primary:#405189,secondary:#0ab39c"
                    style="width:150px;height:150px">
                </lord-icon>
                <div class="mt-4 pt-3">
                    <h4 class="mb-3">Follow-Up Email</h4>
                    <p class="text-muted mb-4">Hide this modal and show the first with the button below Automatically Send your invitees a follow -Up email.</p>
                    <div class="hstack gap-2 justify-content-center">
                        <!-- Toogle to first dialog, `data-bs-dismiss` attribute can be omitted - clicking on link will close dialog anyway -->

                        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!--datatable js-->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

    <script src="{% static 'assets/js/pages/datatables.init.js' %}"></script>
    <script src="{% static 'assets/libs/node-waves/waves.min.js' %}"></script>
    <script src="{% static 'assets/libs/feather-icons/feather.min.js' %}"></script>
    <!-- flatpickr -->
    <script src="{% static 'assets/libs/flatpickr/flatpickr.min.js' %}"></script>
    <script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'assets/libs/simplebar/simplebar.min.js' %}"></script>

    <script>
        jQuery(document).ready(function () {
            $.noConflict();
            var table = jQuery('#ChildList').DataTable({
                select: true,
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                dom: 'Bfrtip',
                order: [[5, 'desc']],
                "bDestroy": true,
                buttons: [
                    'colvis',
                    'excel',
                    'print'
                ]
            });

        });
        jQuery('#showModal').on('hidden.bs.modal', function () {
            jQuery(this).find('form').trigger('reset');
        });

    </script>


    <!-- App js -->
    <script src="{% static 'assets/js/app.js' %}"></script>





{% endblock %}