{% extends "base.html" %} {% load static %} 
{% block UserName %} {{ UserName }}{% endblock %} 
{% block Title %} SETTINGS {% endblock %} 
{% block functionTitle %}ADDITIONAL RATES{% endblock %} 
{% block content %}

 <div class="row">
<div class="card">
    <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Base Rate</h4>
        <div class="flex-shrink-0">
            <div class="form-check form-switch form-switch-right form-switch-md">
                <label for="inline-form-showcode" class="form-label text-muted">Show Code</label>
                <input class="form-check-input code-switcher" type="checkbox" id="inline-form-showcode">
            </div>
        </div>
    </div><!-- end card header -->
    <div class="card-body">
        <p class="text-muted">Select the base rate.</p>
        <div class="live-preview">
            <form action="javascript:void(0);">
                <div class="row">
                        <div class="col-lg-6">
                            {{form.base_rate}}
                    </div>
                </div>
                <!--end row-->
                <div class="row">
                        <div class="row gy-4">
                            <div id="tblDiv">
                                <table id="RateList" class="display" style="width: 100%">
                                    <thead>
                                    <tr>
                                        <th>Slot</th>
                                        <th>Rate</th>
                                        <th>Effective from</th>
                                        <th>Effective to</th>
                                        <th data-orderable="false"></th>
                                    </tr>
                                    </thead>
                                </table>
                            </div>
                        </div>
            </form>
        </div>
        
    </div>
    <!--end card-body-->
</div>

</div>



<div class="row">
<div class="card">
    <div class="card-header border-0">
        <div class="d-flex align-items-center">
            <h5 class="card-title mb-0 flex-grow-1">Additional hours rates</h5>
            
        </div>
    </div>

    <div class="row ">
        <div class="card-body">
            <form  action="{% url 'core:save_additional_rates' %}"
            method="POST">
            {% csrf_token %}
        
                
                    <div class="row ">
                       
                        <!--end col-->
                        <div class="col-sm-2">
                            {{form.slot_number_hour}}
                        </div>
                        <div class="col-sm-2">
                            {{form.extra_rate}}
                        </div>
                        <div class="col-sm-2">
                            {{form.effective_from}}
                        </div>
                        <div class="col-sm-2">
                            <button
                            class="btn btn-secondary add-btn">
                        <i class="ri-add-line align-bottom me-1"></i> Save rate
                    </button>
                        </div>
        
                   
                    </div> </br>
                  
                </form>
                </div>
    </div>
    
        <!-- end card-body -->

        

   
</div>
</div>
{% endblock %} {% block modals %}
<div
        class="modal fade zoomIn"
        id="showModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        style="display: none"
        aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0">
            <div class="modal-header p-3 bg-secondary-subtle">
                <h5 class="modal-title" id="exampleModalLabels">Add Child</h5>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-target="#showModalCreate"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        id="close-modalAdd"
                ></button>
            </div>

        </div>
    </div>
</div>


<!-- Settings Form -->
<div class="modal fade zoomIn" id="showModalCreate" tabindex="-1" aria-labelledby="exampleModalLabel"
     style="display: none" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0">
            <div class="modal-header p-3 bg-secondary-subtle">
                <h5 class="modal-title">Add Rates</h5>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        id="close-modal"></button>
            </div>
            <form
                    action="{% url 'core:save_additional_rates' %}"
                    method="POST"
                    class="tablelist-form"
                    autocomplete="on">
                {% csrf_token %}

                <div class="modal-body">
                    
                    <div class="row">
                        
                            <div class="card">
                                <div class="card-header align-items-center d-flex">
                                    <h4 class="card-title mb-0 flex-grow-1">Additional Rate Details</h4>
                                    <div class="flex-shrink-0">
                                        <div class="alert alert-dismissible" role="alert">
                                            {% if messages %} {% for message in messages %}
                                            <!-- Danger Alert -->
                                            <div
                                                    class="alert alert-{{ message.tags }} alert-dismissible border-2 bg-body-secondary fade show"
                                                    role="alert"
                                            >
                                                <strong>
                                                    <center>{{ message }}</center>
                                                </strong>
                                                <button
                                                        type="button"
                                                        class="btn-close"
                                                        data-bs-dismiss="alert"
                                                        aria-label="Close"
                                                ></button>
                                            </div>
                                            {% endfor %} {% endif %}
                                            <!-- end row -->
                                        </div>
                                    </div>
                                </div>
                                <!-- end card header -->
                                
                                <div class="card-body">
                                    <div class="live-preview">
                                        <div class="row gy-4">
<div class="col-12">
                                                {{ form.base_rate }}
                                            </div>

                                            <!--end col-->
                                            <div class="col-xxl-3 col-md-6">
                                                <div>{{ form.slot_number }}</div>
                                            </div>
                                            <!--end col-->

                                            <div class="col-xxl-3 col-md-6">
                                                <div>
                                                        {{ form.extra_hour_rate }}
                                                </div>
                                            </div>
                                            
                                             <div class="col-xxl-3 col-md-6">
                                                <div>
                                                        {{ form.effective_from }}

                                                    </div>
                                            </div>
                                             <div class="col-xxl-3 col-md-6">
                                                <div>
                                                        {{ form.effective_to }}

                                                    </div>

                                            </div>


                                            <!--end col-->
                                            <div class="hstack gap-2 justify-content-end">
                                                <button type="button" class="btn btn-light" data-bs-dismiss="modal">
                                                    Close
                                                </button>
                                                <button class="btn btn-secondary" type="submit">Save</button>
                                                
                                            </div>

                                            

                                        </div>
                                        <!--end row-->
                                    </div>
                                </div>
                            </div>
                     
                        </div>
                    
                </div>
                <div class="modal-footer" style="display: block">
                   
                </div>
            </form>
        </div>
    </div>
</div>

<!--Update Form-->
<div class="modal fade zoomIn" id="showUpdateModal" tabindex="-1" aria-labelledby="exampleModalLabel"
     style="display: none" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0">
            <div class="modal-header p-3 bg-secondary-subtle">
                <h5 class="modal-title">Update child details</h5>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        id="close-upmodal"
                ></button>
            </div>
            <div id="modelForm">

            </div>
        </div>
    </div>
</div>

<!-- First modal dialog -->
<div
        class="modal fade"
        id="firstmodal"
        aria-hidden="true"
        aria-labelledby="..."
        tabindex="-1"
>
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <img
                        src="{% static 'assets/images/stop.gif' %}"
                        alt="alert"
                        width="100px"
                        height="100px"
                />
                <div class="mt-4 pt-4">
                    <h4>You are about to deactivate this Child!</h4>
                    <p class="text-muted">
                        Are you sure? Please note that hs/she will not be able to check
                        in/out to daycare facility.
                    </p>
                    <!-- Toogle to second dialog -->
                    <button
                            class="btn btn-secondary"
                            data-bs-target="#firstmodal"
                            data-bs-toggle="modal"
                            data-bs-dismiss="modal"
                    >
                        No
                    </button>
                    <button
                            name="btnModelDelete"
                            id="btnModelDelete"
                            class="btn btn-danger"
                    >
                        Yes
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Second modal dialog -->
<div
        class="modal fade"
        id="secondmodal"
        aria-hidden="true"
        aria-labelledby="..."
        tabindex="-1"
>
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center p-5">
                <img
                        src="{% static 'assets/images/done.gif' %}"
                        alt="alert"
                        width="75px"
                        height="75px"
                />
                <div class="mt-4 pt-3">
                    <h4 class="mb-3">Operation completed</h4>
                    <div class="hstack gap-2 justify-content-center">
                        <!-- Toogle to first dialog, `data-bs-dismiss` attribute can be omitted - clicking on link will close dialog anyway -->

                        <button
                                type="button"
                                id="secondButton"
                                class="btn btn-secondary"
                                onclick="location=URL"
                                data-bs-dismiss="modal"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block scripts %}
<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<!--datatable js-->
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>

<script src="{% static 'assets/js/pages/datatables.init.js' %}"></script>
<script src="{% static 'assets/libs/node-waves/waves.min.js' %}"></script>
<script src="{% static 'assets/libs/feather-icons/feather.min.js' %}"></script>
<!-- flatpickr -->
<script src="{% static 'assets/libs/flatpickr/flatpickr.min.js' %}"></script>
<script src="{% static 'assets/libs/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'assets/libs/simplebar/simplebar.min.js' %}"></script>

<script>
    var $ = jQuery;
    dataTable = "";


    jQuery("#showModal").on("hidden.bs.modal", function () {
        jQuery(this).find("form").trigger("reset");
        

    });

    var url = "";

    jQuery(document).on("click", ".link-success", function (e) {
        e.preventDefault();
        url = jQuery(this).attr("href");
        // Show the modal
        jQuery("#showUpdateModal").modal("show");

        // Load the form into the modal using AJAX
        jQuery.ajax({
            type: "GET",
            url: "{% url 'core:view_additional_rates_js' %}",
            dataType: "html",
            success: function (data) {
                // Assuming you have a modal body with the id "updateModalBody"
                jQuery("#modelForm").html(data);
            },
            error: function (xhr, textStatus, errorThrown) {
                alert("Error: " + xhr.status + ", " + xhr.statusText);
            }
        });

    });
    var dataTable;
    jQuery(document).ready(function () {
        dataTable = $('#RateList').DataTable({
            
           dom: "Bfrtip",
            pageLength: 50,

            buttons: ["excel", "print"],
            order: [[0, "asc"]],
            retrieve: true,
    });
        
        
    });

    jQuery('#base_rate').change(function () {
        var baseRateId = jQuery(this).val();
        dataTable.clear();
        jQuery.ajax({
                url: "{% url 'core:view_additional_rates_js' %}",
                type: "GET",
                data: { base_rate_id: baseRateId },
                beforeSend: function () { },
                success: function (response) {       
                    
                jQuery.each(response, function(i, item) {
                var url = "{% url 'core:view_child_with_id' 0 %}".replace(0, response[i].id);

                console.log(response[i].id)
                dataTable.row.add(                 
                [response[i].slot_number_hour,
                response[i].extra_rate,
                response[i].effective_from,
                response[i].effective_to,
                '<a href="' + url + '" class="link-success" data-bs-target="#showUpdateModal" data-bs-toggle="modal" data-bs-dismiss="modal" role="button" data-value="' + response[i].id + '"><i class="ri-edit-2-fill"></i></a>',
                ],)
                });

             

            dataTable.draw();
                },error: function(response){
                    console.log(response);
            }
        });
     
    });
    
   
    jQuery("secondButton").click(function () {
        window.parent.location = window.parent.location.href;
    });
</script>

<!-- App js -->
<script src="{% static 'assets/js/app.js' %}"></script>

{% endblock %}
